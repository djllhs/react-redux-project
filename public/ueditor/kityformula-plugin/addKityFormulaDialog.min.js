UE.registerUI("kityformula",function(t,e){var a=new UE.ui.Dialog({iframeUrl:t.options.UEDITOR_HOME_URL+"kityformula-plugin/kityFormulaDialog.html",editor:t,name:e,title:"插入公式",cssRules:"width:783px; height: 386px;",buttons:[{className:"edui-okbutton",label:"确定",onclick:function(){a.close(!0)}},{className:"edui-cancelbutton",label:"取消",onclick:function(){a.close(!1)}}]});t.ready(function(){UE.utils.cssRule("kfformula","img.kfformula{vertical-align: middle;}",t.document)});var i=t.options.UEDITOR_HOME_URL+"kityformula-plugin/kf-icon.png",n=document.createElement("a");n.href=i,n.href=n.href,i=n.href;var o=new UE.ui.Button({name:"插入"+e,title:"插入公式-"+e,cssRules:'background: url("'+i+'") !important',onclick:function(){a.render(),a.open(),$(".edui-dialog-foot").append('<div class="mathtype-btn">点击使用MathType插入更多公式</div>');var e=['<div class="math-box"><p class="math-hint">如无MathType软件工具请直接打开百度搜索"MathType"进行下载，谢谢〜</p>','<div class="math-code-box"><input class="math-code" type="text" placeholder="请在此粘贴公式代码"><span class="math-code-btn math-btn">预览</span><a class="math-btn" href="http://yuntiexamitempig.oss-cn-qingdao.aliyuncs.com/mathtex.pdf" target="_blank">语法说明</a></div>','<div class="math-preview"><p class="math-default">在此预览公式效果</p></div></div>'].join(""),i="http://texmath.bookln.cn/cgi-bin/math.cgi?",n=new UE.ui.Dialog({content:e,editor:t,name:"mathtype",title:"插入公式 - MathType",cssRules:"width:783px; height: 386px;",buttons:[{className:"edui-okbutton",label:"确定",onclick:function(){var e=$(".math-code"),a=e.val().trim();a&&t.execCommand("insertHtml",'<img style="max-width:100%;" src="'+i+a+'">'),n.close(!0)}},{className:"edui-cancelbutton",label:"取消",onclick:function(){n.close(!1)}}]});$("body").on("click",".mathtype-btn",function(){$(".edui-for-mathtype").remove(),n.render(),n.open(),$(".edui-for-kityformula").remove()}),$("body").on("click",".math-code-btn",function(){var t=$(".math-code"),e=t.val().trim();e?$(".math-preview").html('<img src="'+i+e+'">'):(t.addClass("hint-animations"),setTimeout(function(){t.removeClass("hint-animations")},2e3))})}});return t.addListener("selectionchange",function(){var a=t.queryCommandState(e);a==-1?(o.setDisabled(!0),o.setChecked(!1)):(o.setDisabled(!1),o.setChecked(a))}),o});